电话


# 项目里的服务发现是怎么做的

1. 新起了一个项目注册类
2. 注册的时候，会和etcd连接，把服务的基本信息写入etcd，包括服务的名字，ip地址，端口号。并且会把已经注册的服务加入遇到一个set里面，方便heartBeat函数，定时调用，重新注册服务，维持服务生命活动
3. 服务发现：根据服务名字，在ectd里面根据前缀匹配找到服务，找到需要的key之后，把会调用watch监听key的函数，并且根据key获取服务信息，把服务信息存到list集合里面。最后把这个list集合放入ConcurrentHashMap的集合里面，作为Cache
4. 启动Etcd的事件监听机制，监听Key的内容变化。
# ConcurrentHashMap在我的项目里怎么起到线程安全的作用

主要是用来做到并发写Cache，这样可以保证总是Cache的数据是最新的，不会说Cache里面出现无法请求的服务


# 负载均衡是怎么做的
做了xxxx负载均衡，通过工厂模式获取负载均衡选择器

一致性哈希（传入请求参数和服务信息列表）
用服务信息列表+随机参数，构造哈希虚拟环。（一个服务信息构造一拜个虚拟节点）
利用请求参数获取哈希值，找到大于等于调用请求 hash 值的虚拟节点，返回。